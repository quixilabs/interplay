# The Growth Index - Project Rules

## ğŸ¯ Project Overview
Student flourishing analytics platform using React, TypeScript, Vite, Tailwind CSS, and Supabase. Built on Harvard's Flourishing Measure framework for comprehensive student well-being assessment.

---

## ğŸ“ Project Structure & Organization

### File Organization Rules
**CRITICAL**: Maintain the organized folder structure at all times:

```
â”œâ”€â”€ docs/                    # All .md documentation files (except README.md)
â”œâ”€â”€ scripts/                 # All .js and .sh utility scripts
â”œâ”€â”€ sql/                     # SQL data dumps and verification scripts
â”œâ”€â”€ supabase/migrations/     # Database migration files only
â”œâ”€â”€ config/                  # Configuration files (nginx, etc.)
â”œâ”€â”€ src/                     # Application source code
â”‚   â”œâ”€â”€ components/          # React components
â”‚   â”œâ”€â”€ services/            # Business logic and API calls
â”‚   â”œâ”€â”€ stores/              # Zustand state management
â”‚   â”œâ”€â”€ types/               # TypeScript type definitions
â”‚   â”œâ”€â”€ utils/               # Helper functions
â”‚   â”œâ”€â”€ contexts/            # React Context providers
â”‚   â””â”€â”€ data/                # Constants and mock data
â””â”€â”€ [root]                   # Only README.md and build tool configs
```

### File Placement Guidelines

**Documentation (.md files)**
- âœ… Keep `README.md` in root
- âœ… Move all other .md files to `docs/`

**SQL Files**
- âœ… Database migrations â†’ `supabase/migrations/`
- âœ… Data dumps & verification â†’ `sql/`
- âŒ NEVER place SQL files in root

**Scripts**
- âœ… All .js utility scripts â†’ `scripts/`
- âœ… All .sh shell scripts â†’ `scripts/`
- âŒ NEVER place utility scripts in root

**Config Files**
- âœ… Build tool configs (eslint, tailwind, vite, etc.) â†’ root
- âœ… Server configs (nginx, etc.) â†’ `config/`

---

## ğŸ¨ TypeScript & React Best Practices

### Component Guidelines

**Functional Components Only**
```tsx
// âœ… GOOD
export const StudentDashboard = () => {
  const [data, setData] = useState<StudentData[]>([]);
  return <div>...</div>;
};

// âŒ BAD - No class components
export class StudentDashboard extends React.Component { }
```

**Type Safety**
```tsx
// âœ… GOOD - Explicit types for props and state
interface DashboardProps {
  universityId: string;
  timeRange: 'week' | 'month' | 'year';
}

export const Dashboard = ({ universityId, timeRange }: DashboardProps) => {
  // ...
};

// âŒ BAD - Using 'any'
export const Dashboard = (props: any) => { }
```

**File Naming**
- Components: `PascalCase.tsx` (e.g., `FlourishingChart.tsx`)
- Services: `camelCase.ts` (e.g., `analyticsService.ts`)
- Utils: `camelCase.ts` (e.g., `dateFormatters.ts`)
- Types: `camelCase.ts` (e.g., `survey.ts`)

### State Management

**Zustand Stores**
```typescript
// âœ… GOOD - Create focused stores
import { create } from 'zustand';

interface SurveyStore {
  currentStep: number;
  responses: SurveyResponse[];
  setCurrentStep: (step: number) => void;
}

export const useSurveyStore = create<SurveyStore>((set) => ({
  currentStep: 0,
  responses: [],
  setCurrentStep: (step) => set({ currentStep: step }),
}));
```

**React Context**
- Use Context for authentication and theme
- Use Zustand for application state
- Avoid prop drilling beyond 2 levels

---

## ğŸ—„ï¸ Supabase Database Conventions

### Query Patterns

**Always Use TypeScript Types**
```typescript
// âœ… GOOD
const { data, error } = await supabase
  .from('flourishing_scores')
  .select('*')
  .eq('session_id', sessionId);

if (error) {
  console.error('Database error:', error);
  throw new Error(`Failed to fetch scores: ${error.message}`);
}

// âŒ BAD - No error handling
const { data } = await supabase.from('flourishing_scores').select('*');
```

**Migration Files**
- Name format: `YYYYMMDDHHMMSS_descriptive_name.sql`
- Always place in `supabase/migrations/`
- Include rollback scripts when appropriate
- Test migrations locally before applying

### RLS Policies
- Always enable Row Level Security on new tables
- Document policy purpose in comments
- Test with anonymous and authenticated users
- Use descriptive policy names

---

## ğŸ¯ Code Quality Standards

### Error Handling

**Always Handle Errors Explicitly**
```typescript
// âœ… GOOD
try {
  const result = await fetchStudentData(sessionId);
  return result;
} catch (error) {
  console.error('Failed to fetch student data:', error);
  throw new Error('Unable to load student information');
}

// âŒ BAD - Silent failures
try {
  await fetchStudentData(sessionId);
} catch (e) { }
```

### Import Organization
```typescript
// âœ… GOOD - Organized imports
// 1. External libraries
import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabase';

// 2. Internal components
import { FlourishingChart } from '@/components/Dashboard/FlourishingChart';

// 3. Types
import type { StudentData, FlourishingScore } from '@/types/survey';

// 4. Utils
import { formatDate } from '@/utils/dateFormatters';
```

### Naming Conventions

**Variables & Functions**
- `camelCase` for variables and functions
- `PascalCase` for components and classes
- `SCREAMING_SNAKE_CASE` for constants
- Descriptive names over short names

```typescript
// âœ… GOOD
const MAX_SURVEY_ATTEMPTS = 3;
const studentFlourishingScores = await fetchScores();

// âŒ BAD
const max = 3;
const data = await fetch();
```

---

## ğŸ§ª Testing & Debugging

### Console Logging
```typescript
// âœ… GOOD - Structured logging
console.log('Survey submitted:', { sessionId, timestamp: new Date() });

// âŒ BAD - Generic logs
console.log('here');
console.log(data);
```

### Environment Variables
- Always use `VITE_` prefix for client-side variables
- Never commit `.env` files
- Document all required variables in `.env.example`
- Validate env vars on app startup

---

## ğŸš€ Performance Best Practices

### React Performance
```tsx
// âœ… GOOD - Memoize expensive calculations
const chartData = useMemo(
  () => processStudentData(rawData),
  [rawData]
);

// âœ… GOOD - Use callback for handlers
const handleSubmit = useCallback((data: FormData) => {
  submitSurvey(data);
}, []);
```

### Database Queries
- Select only needed columns
- Use indexes for frequently queried fields
- Implement pagination for large datasets
- Cache results when appropriate

---

## ğŸ“ Documentation Standards

### Code Comments
```typescript
// âœ… GOOD - Explain WHY, not WHAT
// Calculate risk score based on flourishing domains below threshold
// Domains scoring < 3.0 indicate areas needing intervention
const riskScore = calculateRiskScore(flourishingScores);

// âŒ BAD - Obvious comments
// This is a function that calculates risk score
const riskScore = calculateRiskScore(flourishingScores);
```

### Component Documentation
```tsx
/**
 * FlourishingChart - Displays student flourishing metrics across 6 domains
 * 
 * @param data - Array of flourishing scores per domain
 * @param timeRange - Filter results by time period
 * @param showTrendLine - Display trend analysis overlay
 */
export const FlourishingChart = ({ data, timeRange, showTrendLine }: Props) => {
  // ...
};
```

---

## ğŸ”’ Security & Privacy

### Data Handling
- **NEVER** log personally identifiable information
- Use session IDs for anonymous tracking
- Validate all user inputs
- Sanitize data before database insertion
- Follow FERPA compliance for student data

### Authentication
- Check auth state before protected operations
- Use RLS policies for data access control
- Implement proper session management
- Never expose API keys in client code

---

## âœ¨ Tailwind CSS Conventions

```tsx
// âœ… GOOD - Organized utility classes
<div className="flex items-center justify-between gap-4 rounded-lg bg-white p-6 shadow-sm">

// âœ… GOOD - Extract repeated patterns to components
// Consider creating reusable components for repeated styling patterns

// âŒ BAD - Inline styles
<div style={{ display: 'flex', padding: '24px' }}>
```

---

## ğŸ”„ Git Commit Guidelines

**Format**: `type: brief description`

**Types**:
- `feat:` New feature
- `fix:` Bug fix
- `refactor:` Code restructuring
- `docs:` Documentation changes
- `style:` Formatting, no code change
- `chore:` Maintenance tasks
- `perf:` Performance improvements

**Examples**:
```bash
feat: add demographic filtering to dashboard
fix: resolve survey session duplication issue
refactor: reorganize project structure - move SQL and scripts
docs: update deployment instructions
```

---

## ğŸ¯ When Making Changes

1. **Respect the folder structure** - Files belong in their designated folders
2. **Type everything** - No `any` types without justification
3. **Handle errors** - Never silently fail
4. **Test changes** - Verify functionality before committing
5. **Document decisions** - Add comments for complex logic
6. **Keep it clean** - Remove unused imports, variables, and files
7. **Follow conventions** - Match existing code style and patterns

---

**Remember**: These rules maintain code quality and project organization. When in doubt, refer to existing patterns in the codebase or ask for clarification.
